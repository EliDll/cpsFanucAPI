PROGRAM loopctest1
%STACKSIZE = 4000
%NOLOCKGROUP
%NOPAUSE=ERROR+COMMAND+TPENABLE
%ENVIRONMENT uif
%ENVIRONMENT sysdef
%ENVIRONMENT memo
%ENVIRONMENT kclop
%ENVIRONMENT bynam
%ENVIRONMENT fdev
%ENVIRONMENT flbt
%INCLUDE klevccdf
%INCLUDE klevkeys
%INCLUDE klevkmsk

VAR
	file_var : FILE
	tmp_int : INTEGER
	tmp_str : STRING[128]
	status: INTEGER
	entry: INTEGER
	loop1: BOOLEAN
	
BEGIN
	SET_FILE_ATR(file_var, ATR_IA)
	SET_VAR(entry, '*SYSTEM*', '$HOSTC_CFG[5].$SERVER_PORT', 8000, status)
	-- Connect the tag
	WRITE('Connecting...', CR)
	MSG_CONNECT('C5:', status)
	WRITE('Connect Status = ', status, CR)
	loop1 = TRUE
	IF status = 0 THEN
		WHILE loop1 = TRUE DO
			WRITE('Opening File...',CR)
			OPEN FILE file_var('rw', 'C2:')
			status = IO_STATUS(file_var)
			IF STATUS = 0 THEN
				FOR tmp_int = 1 TO 100 DO
					tmp_str = '0123456789012345'
					WRITE file_var(tmp_str::10)
					WRITE('Wrote 126 Bytes', CR)
					IF status <> 0 THEN
						WRITE('Loop Test Fails', CR)
						loop1 = FALSE
						tmp_int = 100
					ELSE
						WRITE('Read 126 Bytes', CR)
						READ file_var(tmp_str::10)
						status = IO_STATUS(file_var)
						WRITE('Read Status ', status, CR)
					ENDIF
				ENDFOR
				WRITE('Closed File', CR)
				CLOSE FILE file_var
			ELSE
				WRITE('Error Opening File', CR)
				loop1 = FALSE
			ENDIF
		ENDWHILE
		WRITE('Disconnecting...', CR)
		MSG_DISCO('C2:', status)
		WRITE('Done.', CR)
	ENDIF
END loopctest1